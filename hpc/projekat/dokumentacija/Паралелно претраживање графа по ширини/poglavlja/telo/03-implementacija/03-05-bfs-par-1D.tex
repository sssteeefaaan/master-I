\section{Паралелна имплементација \textit{BFS} алгоритма са дељеном меморијом и једнодимензионим партиционисањем чворова}
Имплементација је одрађена користећи \textit{OpenMP} алат за програмски језик \textit{C} у оквиру кога је имплементирана следећа функција. Граф је и у овој имплементацији представњен користећи матрицу суседства, односно два низа, један који представља назубљену матрицу потега и други који представља помераје за одговарајући чвор у матрици потега. Функција која имплементира паралелни \textit{BFS} са дељеном меморијом је дефинисана у исечку \ref{code:bfs-par-general}. Функција \cinline{void bfs_par(...)} прима:
\begin{enumerate}
    \item \textit{long long* graph} - низ целобројних вредности који садржи сегменте за суседе одговарајућих темена,
    \item \textit{long long* degrees} - низ целобројних вредности који садржи помераје у оквиру низа \textit{graph},
    \item \textit{long long vertex\_numb} - целобројна вредност која представља број потега у графу, односно димензију низа \textit{degrees} ($\textit{vertex\_numb} + 1$),
    \item \textit{long long start} - целобројна вредност која представља индекс почетног чвора у оквиру низа \textit{degrees},
    \item \textit{long long* distance} - низ целобројних вредности у оквиру којих ће бити бележено растојање од почетног чвора $start$ до чвора $v_i$ представљено у виду броја суседа који деле ова два чвора и
    \item \textit{long long num\_threads} - целобројну вредност која представља жељени број нити са којима желимо да извшимо функцију.
\end{enumerate}

\begin{listing}[H]
\inputminted[fontsize={\fontsize{6}{6}\selectfont},firstline=71,lastline=162]{c}{kodovi/bfs-par-general-1d.c}
\caption{\textit{Паралелна имплементација \textit{BFS} алгоритма са дељеном меморијом и једнодимензионим партиционисањем чворова}}
\label{code:bfs-par-general}
\end{listing}

\par
У оквиру линија 79-83 се врши иницирање дељених променљивих \textit{F\_global\_count}, \textit{work\_load}, низа \textit{N} и низа \textit{N\_size}. С обзиром да овде нећемо имати комуникацију између нити, а коришћење синхронизације је јако скупоцено за перформансе, нећемо штедети на меморији и низ \textit{N} ће бити алоциран на величину од $num\_threads^2 \cdot vertex\_numb$, где ће свака нит имати свој сегмент у оквиру ког може уписивати темена која припадају осталим нитима, из којег ће остале нити касније моћи да преузму локална темена која су им додељена. Идеја је да постоји тродимензиони низ $N[receiving\_thread][sending\_thread][vertexes]$.

\par
Паралелни регион се креира у оквиру сегмента у линијама 85-158 са жељеним бројем нити. У оквиру линије 87 се рачуна колико нити је креирано у паралелном региону и та врдност смешта у локалну променљиву $thread\_numb$. У оквиру линија 89 и 93 се врши расподела посла тако да све нити врше иницијализацију елемената дељеног вектора \textit{distance} на вредност \textit{INFINITY}, a једна нит касније индекс вредност елемента $distance[start]$ коригује вредношћу $0$.

\par
Након овога се у линијама 96-99 врши иницијализација осталих локалних променљивих. Променљива \textit{F} ће бити локални низ где ће свака нит бележити своја локална темена која су гранична за тренутну итерацију. Променљива \textit{F\_count} ће бележити локалну вредност дужине низа \textit{F}. Локална променљива \textit{level} ће бележити ниво, односно дубину графа до које се дошло у тренутној итерацији, док ће локални низ $dups$ бележити које индексе је тренутна нит уписала у низ $N$ за одговарајућу нит. у линији 101 се елементи овог вектора иницијализују на $0$, с обзиром да још увек није покренуто уношење вредности, а ово је потребно одрадити само једном, с обзиром да не желимо да разматрамо темена која су већ послата одговарајучој нити на обраду.

\par
У оквиру линије 103 се отпочиње бесконачна \textit{while} петља коју извршавају све нити засебно. Инструкција на линији 105 иницијализује променљибу којом се бележи величину низа $F$ на $0$. У оквиру линија 107-112 се за одговарајући сегмент који је додељен локалној нити врши тражење оних темена који за своје растојање од почетног чвора имају растојање једнако дубини графа тренутне итерације. Логика линија 114-123 јесте да одраде редукцију величина свих локалних низова $F$, упишу у дељиву промељиву и уколико је вредност $0$, то значи да смо истражили сва темена до којих имамо потеге и да треба да се изађе из бесконачне $while$ петље.

\par
У линијама 125-127 се врши инцијализација свих елемената низа \textit{N\_size} на $0$, а онда свака од нити извршава петљу у оквиру линија 129-141. Логика ове петље јесте да за сваки од локалних темена из низа \textit{F} нађе суседе и уколико се они не налазе у низу дупликата \textit{dups}, упише их у њега, као и на одговарајућу позицију и оквиру тродимензионог низа \textit{N}, из ког ће заинтересоване нити касније очитати вредности. С обзиром да је неопходно и опсег до ког су вредности ових елемената валидни, врши се и инкрементирање одговарајућег елементе у оквиру низа \textit{N\_size}. Сам померај у оквиру ова два низа се добија на следећи начин. Када целобројно поделимо вредност индекса за суседно теме са вредношћу количине посла који добија свака нит, добићемо идентификатор нити којем је додељено то суседно теме. Да би се добио померај од ког треба да уписује тренутна нит, идентификатор нити којој припада суседни чвор треба помножити са укупним бројем нити и на ту вредност додати идентификатор нити која врши упис. Овај померај ће се користити у оквиру низа \textit{N\_size}, а да бисмо добили померај у оквиру низа \textit{N}, тај померај је неопходно помножити са укупним бројем чворова у графу и на њега додати број претхдно уписаних темена за тај сегмент, што је вредност из низа \textit{N\_size} са претходно израчунатим померајем.

\par
На линији 143 је постављена експлицитна баријера, с обзиром да је неопходно сачекати да све нити разврстају предстојећа гранична темена у низу \textit{N}. На крају, у линијама 145-152, и \textit{for} петљи коју извршава свака нит, врши се рачунање помераја у низу \textit{N}, читају темена која су послата од нити са идентификатором $i$ и уколико у дељеном вектору \textit{distance} одговарајуће теме има вреднист \textit{INFINITY}, обавиће се корекција на вредност $\textit{level} + 1$. Овде није потребно вршити никакву синхронизацију, нити водити рачуна о услову трке, с обзиром да свака нит ради са индексима локалних темена и ни у једном тренутку не преписује вредности других нити. У последљим линијама кода се врши деалоцирање меморије за низове.

\subsection{Перформансе имплементације алгоритма}
Дијаграм који илуструје однос броја чворова и времена потребног за проналажење растојања до досежних чворова из почетног чвора је приказа на слици \ref{diagram:bfs-par-1D-vertex-numb-variable}. Подаци су приказани и у оквиру табеле \ref{table:bfs-par-1D-vertex-variable}.

\begin{table}[H]
    \centering
\rowcolors{2}{light blue}{}
\begin{tabular}{| m{.15\textwidth} | m{.15\textwidth} | m{.15\textwidth} | m{.15\textwidth} | m{.15\textwidth} |}
    \hline \rowcolor{dark blue}
     \textbw{Број темена} & \textbw{Максималан број потега} & \textbw{Минималан број потега} & \textbw{Време извршавања} & \textbw{Број нити} \\ \hline
         50 & 10 & 1 & 0.000123 & 10 \\ \hline
         100 & 10 & 1 & 0.000135 & 10 \\ \hline
         500 & 10 & 1 & 0.000344 & 10 \\ \hline
         1000 & 10 & 1 & 0.000415 & 10 \\ \hline
         5000 & 10 & 1 & 0.000879 & 10 \\ \hline
         10000 & 10 & 1 & 0.001432 & 10 \\ \hline
         50000 & 10 & 1 & 0.006063 & 10 \\ \hline
         100000 & 10 & 1 & 0.012052 & 10 \\ \hline
         500000 & 10 & 1 & 0.145075 & 10 \\ \hline
    \end{tabular}
    \caption{\textit{Перформансе паралелне имплементације \textit{BFS} алгоритма са дељеном меморијом и једнодимензионим партиционисањем са променом броја темена}}
    \label{table:bfs-par-1D-vertex-variable}
\end{table}

\begin{figure}[H]
    \centering
    \begin{tikzpicture}
        \begin{axis}[
                xtick={100, 1000, 10000, 100000, 10000000},
                xmode=log,
                log ticks with fixed point,
                xlabel={Број темена},
                ylabel={Време извршења},
                width=.7\columnwidth
                ]
            \addplot+
            table[x=VN, y=T]{testovi/par-1D-vertex-numb-variable.txt};
        \end{axis}
    \end{tikzpicture}
    \caption{\textit{Зависност времена извршења паралелне имплементације \textit{BFS} алгоритма са дељеном меморијом и једнодимензионим партиционисањем од броја темена}}
    \label{diagram:bfs-par-1D-vertex-numb-variable}
\end{figure}

\par
Дијаграм који илуструје однос броја потега и времена потребног за проналажење растојања до досежних чворова из почетног чвора је приказа на слици \ref{diagram:bfs-par-1D-edge-numb-variable}. Подаци су приказани и у оквиру табеле \ref{table:bfs-par-1D-edge-variable}.

\begin{table}[H]
\centering
\rowcolors{2}{light blue}{}
\begin{tabular}{| m{.15\textwidth} | m{.15\textwidth} | m{.15\textwidth} | m{.15\textwidth} | m{.15\textwidth} |}
    \hline \rowcolor{dark blue}
     \textbw{Број темена} & \textbw{Максималан број потега} & \textbw{Минималан број потега} & \textbw{Време извршавања} & \textbw{Број нити} \\ \hline
         10000 & 1 & 1 & 0.001341 & 10 \\ \hline
         10000 & 5 & 1 & 0.001393 & 10 \\ \hline
         10000 & 10 & 5 & 0.001431 & 10 \\ \hline
         10000 & 50 & 10 & 0.001470 & 10 \\ \hline
         10000 & 100 & 50 & 0.002691 & 10 \\ \hline
         10000 & 500 & 100 & 0.007210 & 10 \\ \hline
         10000 & 1000 & 500 & 0.017438 & 10 \\ \hline
         10000 & 5000 & 1000 & 0.067848 & 10 \\ \hline
         10000 & 10000 & 5000 & 0.132995 & 10 \\ \hline
         10000 & 10000 & 10000 & 0.172114 & 10 \\ \hline
\end{tabular}
\caption{\textit{Перформансе паралелне имплементације \textit{BFS} алгоритма са дељеном меморијом и једнодимензионим партиционисањем са променом степена повезаности}}
\label{table:bfs-par-1D-edge-variable}
\end{table}

\begin{figure}[H]
    \centering
    \begin{tikzpicture}
        \begin{axis}[
                xmode=log,
                log ticks with fixed point,
                xlabel={Просечан број потега},
                ylabel={Време извршења},
                width=.7\columnwidth
                ]
            \addplot+
            table[x=EN, y=T]{testovi/par-1D-edge-numb-variable.txt};
        \end{axis}
    \end{tikzpicture}
    \caption{\textit{Зависност времена извршења паралелне имплементације \textit{BFS} алгоритма са дељеном меморијом и једнодимензионим партиционисањем од броја потега}}
    \label{diagram:bfs-par-1D-edge-numb-variable}
\end{figure}

\par
Дијаграм који илуструје однос броја процеса и времена потребног за проналажење растојања до досежних чворова из почетног чвора је приказа на слици \ref{diagram:bfs-par-1D-thread-numb-variable}. Подаци су приказани и у оквиру табеле \ref{table:bfs-par-1D-thread-variable}.

\begin{table}[H]
\centering
\rowcolors{2}{light blue}{}
\begin{tabular}{| m{.15\textwidth} | m{.15\textwidth} | m{.15\textwidth} | m{.15\textwidth} | m{.15\textwidth} |}
    \hline \rowcolor{dark blue}
     \textbw{Број темена} & \textbw{Максималан број потега} & \textbw{Минималан број потега} & \textbw{Време извршавања} & \textbw{Број нити} \\ \hline
         10000 & 10000 & 10000 & 0.690409 & 1 \\ \hline
         10000 & 10000 & 10000 & 0.348251 & 2 \\ \hline
         10000 & 10000 & 10000 & 0.198964 & 4 \\ \hline
         10000 & 10000 & 10000 & 0.155874 & 6 \\ \hline
         10000 & 10000 & 10000 & 0.141484 & 8 \\ \hline
         10000 & 10000 & 10000 & 0.169981 & 10 \\ \hline
         10000 & 10000 & 10000 & 0.153905 & 12 \\ \hline
         10000 & 10000 & 10000 & 0.138699 & 14 \\ \hline
         10000 & 10000 & 10000 & 0.131912 & 16 \\ \hline
\end{tabular}
\caption{\textit{Перформансе паралелне имплементације \textit{BFS} алгоритма са дељеном меморијом и једнодимензионим партиционисањем са променом броја нити}}
\label{table:bfs-par-1D-thread-variable}
\end{table}

\begin{figure}[H]
    \centering
    \begin{tikzpicture}
        \begin{axis}[
                xmode=log,
                log ticks with fixed point,
                xlabel={Број нити},
                ylabel={Време извршења},
                width=.7\columnwidth
                ]
            \addplot+
            table[x=TN, y=T]{testovi/par-1D-thread-numb-variable.txt};
        \end{axis}
    \end{tikzpicture}
    \caption{\textit{Зависност времена извршења паралелне имплементације \textit{BFS} алгоритма са дељеном меморијом и једнодимензионим партиционисањем од броја нити}}
    \label{diagram:bfs-par-1D-thread-numb-variable}
\end{figure}